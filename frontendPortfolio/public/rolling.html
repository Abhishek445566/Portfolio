<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Infinite scroll circular gallery</title>

<!-- Optional: matching fonts used in your CSS -->
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&family=Saira:wght@300;400;600;700&family=Ubuntu:wght@400;700&family=Ubuntu+Mono&display=swap" rel="stylesheet" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@500&family=Saira:ital@0;1&family=Sour+Gummy:wdth,wght@125,300&display=swap" rel="stylesheet">
<style>
/* ===========================
   YOUR CSS (unchanged)
   =========================== */
@property --k {
  syntax: '<number>';
  initial-value: -1;
  inherits: true
}
@property --ang {
  syntax: '<angle>';
  initial-value: 0deg;
  inherits: false
}
* { margin: 0 }
html {
  scrollbar-width: none;
  height: calc(var(--n)*100%)
}
body, header, main, section,
article, figure { display: grid }
body {
  --dir: 0;
  grid-template-rows: max-content 1fr max-content;
  position: fixed;
  width: 100%;
  height: 100vh;
  height: 100dvh;
  color: #dedede;
  font: clamp(.625em, 3vmin, 1.5em)/ 1.25 saira, sans-serif;
  animation: k 1s linear;
  animation-timeline: scroll();
}
body::before {
  position: absolute;
  inset: 0;
  z-index: -1;
  background: #000;
  filter: url(#grain);
  content: ''
}
@media (max-aspect-ratio: 2/ 3) { body { --dir: 1 } }
@keyframes k { to { --k: 1 } }
svg[height='0'][aria-hidden='true'] { position: fixed }
header {
  place-content: center;
  place-items: center;
  padding: .5em;
  text-align: center;
  text-wrap: balance
}
em { max-width: 32em }
main {
  overflow: hidden;
  perspective: 50em
}
section, article { transform-style: preserve-3d }
section {
  --r: calc(2 + var(--dir))/ 3;
  --w: clamp(4em, min(50vh, 25vw), 18em);
  --z: calc(var(--f, 1.25)*-.5*var(--w)/tan(.5turn/var(--n)));
  place-self: center;
  translate: 0 0 var(--z);
  rotate: var(--dir) calc(1 - var(--dir)) 0 calc((var(--k) + .5)*-1turn);
}
article, header, figure, img, figcaption { grid-area: 1/ 1 }
article {
  --j: var(--i)/var(--n);
  --dif-lin: calc(var(--j) - mod(var(--k) + 1, 1));
  --abs-lin: abs(var(--dif-lin));
  --dif-mid: calc(.5 - var(--abs-lin));
  --abs-mid: abs(var(--dif-mid));
  --dif-arc: calc(2*(.5 - var(--abs-mid)));
  --lim: .35;
  --sel: max(0, calc((var(--lim) - var(--dif-arc))/var(--lim)));
  --out: calc(1 - var(--sel));
  --hov: 0;
  width: var(--w);
  aspect-ratio: var(--r);
  transform:
    rotate3d(var(--dir), calc(1 - var(--dir)), 0, calc(var(--j)*1turn))
    translatez(var(--z))
    rotate(calc(var(--dir)*.5turn));
}
article header { rotate: y calc((1 + var(--hov))*.5turn) }
article:hover, article:focus-within { --hov: round(var(--sel)) }
@supports not (scale: abs(-1)) {
  article { --abs-lin: max(var(--dif-lin), -1*var(--dif-lin)); --abs-mid: max(var(--dif-mid), -1*var(--dif-mid)) }
}
article header, figure {
  --ang: calc(-45deg + var(--hov)*180deg);
  overflow: hidden;
  position: relative;
  border: solid 4px #0000;
  border-radius: .5em;
  backface-visibility: hidden;
  box-shadow: 5px 5px 13px #000;
  background:
    var(--url) 50%/ cover padding-box,
    linear-gradient(#666 0 0) padding-box,
    repeating-conic-gradient(from var(--ang),
        #0000 0% 15%,
        color-mix(in srgb,
          #f48c06 calc(var(--sel)*100%), #333) 20% 30%,
        #0000 35% 50%)
      border-box #121212;
  background-blend-mode: multiply, normal, normal;
  isolation: isolate;
  pointer-events: none;
  transition: .35s ease-out;
  transition-property: rotate, --ang;
}
article header::after, figure::after {
  position: absolute;
  inset: 0;
  opacity: var(--out);
  background: #03071e;
  mix-blend-mode: color;
  pointer-events: none;
  content: ''
}
/* reverse from parent */
h2, em, img, a { pointer-events: auto }
h2, em, figcaption {
  opacity: round(up, var(--sel));
  text-shadow: 1px 1px 1px #0006
}
h2 { font-size: 1.125em }
figure { rotate: y calc(var(--hov)*.5turn) }
img {
  width: 100%;
  height: 100%;
  aspect-ratio: var(--r);
  object-fit: cover;
  object-position: var(--pos)
}
figcaption {
  align-self: end;
  padding: .5em;
  background: #fff3;
  color: #040404;
  font: Max(.75rem, .75em) caveat, cursive;
  text-align: right;
  backdrop-filter: blur(5px) brightness(1.5);
}
figcaption a { color: #370617 }
/* just support info boxes if it lacks support */
aside {
  position: fixed;
  bottom: 0;
  padding: .5em;
}
.box-info-scrollani {
  margin: .5em;
  border-left: solid 5px #dc3055;
  padding: .75em;
  box-shadow: 2px 2px 5px hsla(0, 0%, 0%, .35);
  background: #851d40;
  color: #fff;
  font: 1em/ 1.25 ubuntu, trebuchet ms, arial, sans-serif;
}
@supports (animation-timeline: scroll()) {
  .box-info-scrollani { display: none }
}
kbd {
  padding: 2px;
  background: hsla(0, 0%, 0%, .35);
  font: 1.1em/ 1.2 ubuntu mono, consolas, monaco, monospace
}
</style>
</head>

<body>
  <!-- Filter for background grain -->
  <svg width="0" height="0" aria-hidden="true">
    <filter id="grain">
      <feTurbulence type="fractalNoise" baseFrequency="7.13"></feTurbulence>
      <feColorMatrix type="saturate" values="0"></feColorMatrix>
      <feComponentTransfer>
        <feFuncA type="linear" slope=".02"></feFuncA>
      </feComponentTransfer>
      <feBlend in2="SourceGraphic"></feBlend>
    </filter>
  </svg>

  <header>
    <h1>Infinite scroll circular gallery</h1>
    <strong>scroll up &amp; down / use up &amp; down arrow keys</strong>
    <em>mostly CSS scroll-driven animations (for rotating gallery on scroll) + tiniest bit of JS (for infinite cycling part, ~200 bytes minified)</em>
  </header>

  <main class="scene">
    <section class="assembly" id="assembly"></section>
  </main>

  <footer></footer>

  <!-- just support info -->
  <aside>
    <p class="box-info-scrollani">
      Sorry, your browser does not appear to support scroll-driven animation. As of January 2025, this is supported in Firefox if the
      <kbd>layout.css.scroll-driven-animations.enabled</kbd> flag is set to true in <kbd>about:config</kbd> and in Chromium browsers. Safari support is coming, but it hasn't arrived yet.
    </p>
  </aside>

<script>
/* ===========================
   YOUR JS (adapted for DOM)
   =========================== */
(function() {
  const base = 'unsplash.com/photo';
  const data = [
    { common:'Lion', binomial:'Panthera leo', photo:{ code:'1583499871880-de841d1ace2a', page:'lion-lying-on-brown-rock-MUeeyzsjiY8', text:'lion couple kissing on a brown rock', pos:'47% 35%', by:'Clément Roy' } },
    { common:'Asiatic elephant', binomial:'Elephas maximus', photo:{ code:'1571406761758-9a3eed5338ef', page:'shallow-focus-photo-of-black-elephants-hZhhVLLKJQ4', text:'herd of Sri Lankan elephants walking away from a river', pos:'75% 65%', by:'Alex Azabache' } },
    { common:'Red-tailed black cockatoo', binomial:'Calyptorhynchus banksii', photo:{ code:'1619664208054-41eefeab29e9', page:'black-and-brown-bird-in-close-up-photography-LkrOEupiVt8', text:'close-up of a black cockatoo', pos:'53% 43%', by:'David Clode' } },
    { common:'Dromedary', binomial:'Camelus dromedarius', photo:{ code:'1662841238473-f4b137e123cb', page:'a-group-of-camels-in-a-desert-uIzCnO-gOrw', text:'camel and her new born calf walking in the Sahara desert', pos:'65% 65%', by:'Moaz Tobok' } },
    { common:'Polar bear', binomial:'Ursus maritimus', photo:{ code:'1589648751789-c8ecb7a88bd5', page:'polar-bear-on-snow-covered-ground-during-daytime-AZ31hv9kdzE', text:'polar bear on the snow, by the water, raised on the hind legs, front paws together', pos:'50% 25%', by:'Hans-Jurgen Mager' } },
    { common:'Waterbuck', binomial:'Kobus ellipsiprymnus', photo:{ code:'1662187554571-f54ea9657d88', page:'a-deer-with-antlers-in-a-field-jVvl_2cQO5s', text:'waterbuck in a field, looking at the camera', pos:'47%', by:'Jonathan Gensicke' } },
    { common:'Giant panda', binomial:'Ailuropoda melanoleuca', photo:{ code:'1659540181281-1d89d6112832', page:'a-panda-bear-in-a-tree-e0mrn3XDatU', text:'giant panda hanging from a tree branch', pos:'47%', by:'Jiachen Lin' } },
    { common:"Grévy's zebra", binomial:'Equus grevyi', photo:{ code:'1526095179574-86e545346ae6', page:'zebra-standing-on-wheat-field-ZqYPM8i60F8', text:'zebra standing on wheat field, looking back towards the camera', pos:'65% 35%', by:'Jeff Griffith' } },
    { common:'Cheetah', binomial:'Acinonyx jubatus', photo:{ code:'1541707519942-08fd2f6480ba', page:'leopard-sitting-on-grass-field-3pekyY0-yOw', text:'cheetah sitting in the grass under a blue sky', by:'Mike Bird' } },
    { common:'King penguin', binomial:'Aptenodytes patagonicus', photo:{ code:'1595792419466-23cec2476fa6', page:'white-and-black-penguin-on-gray-rock-o4snRPEZRRs', text:'king penguin with a fluffy brown chick on grey rocks', pos:'35%', by:'Martin Wettstein' } },
    { common:'Red panda', binomial:'Ailurus fulgens', photo:{ code:'1689799513565-44d2bc09d75b', page:'a-red-panda-is-sitting-in-a-tree-oVNDSIUQrdc', text:'a red panda in a tree', by:'Niels Baars' } },
    { common:'Leopard', binomial:'Panthera pardus', photo:{ code:'1651611136918-a8a2f8bba419', page:'a-leopard-lying-on-a-rock-VDESlNV85qE', text:'pensive young leopard on a rock', pos:'43% 47%', by:'Andy Silby' } },
    { common:'Hyacinth macaw', binomial:'Anodorhynchus hyacinthinus', photo:{ code:'1624210146024-1046a266038e', page:'blue-and-yellow-macaw-on-brown-tree-branch-during-daytime-wKFd2EhyRAY', text:'two hyacinth macaws on a tree branch', pos:'65% 35%', by:'Juliana e Mariana Amorim' } },
    { common:'Red kangaroo', binomial:'Osphranter rufus', photo:{ code:'1567600868213-60eb570ae39f', page:'brown-kangaroo-eziyddL2OR4', text:'kangaroo in the grass', by:'Jordyn Montague' } },
    { common:'Snow leopard', binomial:'Panthera uncia', photo:{ code:'1639231554431-ebce02bdeacc', page:'a-snow-leopard-sitting-on-top-of-a-rock-JXECZL83E6M', text:'snow leopard sitting on top of a rock, its big fluffy tail hanging down', pos:'50% 25%', by:'Simon Schwyter' } },
    { common:'Sumatran orangutan', binomial:'Pongo abelii', photo:{ code:'1723979757235-73c4767ced1d', page:'a-close-up-of-a-monkey-with-a-smile-on-its-face-uLkwLM7Uw48', text:'close-up of a pensive male orangutan', by:'Fahrul Razi' } },
    { common:'Tiger', binomial:'Panthera tigris', photo:{ code:'1500467525088-aafe28c0a95e', page:'selective-focus-of-tiger-laying-on-ground-LNSIGPuZXIg', text:'close-up of a pensive tiger lying on the ground', pos:'57%', by:'Frida Lannerström' } },
    { common:'Brown bear', binomial:'Ursus arctos', photo:{ code:'1692373202439-4b13694c8a68', page:'a-brown-bear-standing-in-the-middle-of-a-forest-ErfqBlV3AEo', text:'brown bear in the forest, sticking tongue out', pos:'43% 35%', by:'Alexandru-Bogdan Ghita' } },
  ];
  const n = data.length;

  // set --n on <html> for your CSS to use
  document.documentElement.style.setProperty('--n', n);

  // build the rotating gallery
  const $assembly = document.getElementById('assembly');
  const baseImg = `https://images.${base}`;
  const basePage = `https://${base}s/`;

  data.forEach((c, i) => {
    const img = c.photo;
    const pos = img.pos ? `; --pos: ${img.pos}` : '';
    const url = `${baseImg}-${img.code}?h=900`;

    const article = document.createElement('article');
    article.setAttribute('style', `--i: ${i}; --url: url(${url})${pos}`);

    // header (title + binomial)
    const h = document.createElement('header');
    const h2 = document.createElement('h2');
    h2.textContent = c.common;
    const em = document.createElement('em');
    em.textContent = c.binomial;
    h.appendChild(h2);
    h.appendChild(em);

    // figure (image + caption/credit)
    const fig = document.createElement('figure');
    const image = document.createElement('img');
    image.src = url;
    image.alt = img.text;
    const cap = document.createElement('figcaption');
    cap.append('by ');
    const a = document.createElement('a');
    a.href = `${basePage}${img.page}`;
    a.target = '_blank';
    a.rel = 'noopener noreferrer';
    a.textContent = img.by;
    cap.appendChild(a);

    fig.appendChild(image);
    fig.appendChild(cap);

    article.appendChild(h);
    article.appendChild(fig);
    $assembly.appendChild(article);
  });

  // tiny infinite-cycling helper
  function f(k) {
    if (Math.abs(k) > .5) {
      const doc = document.documentElement;
      const maxScroll = doc.offsetHeight - window.innerHeight;
      const target = .5*(k - Math.sign(k) + 1)*maxScroll;
      window.scrollTo(0, target);
    }
  }
  f(-1);

  // sync with CSS-driven value --k
  addEventListener('scroll', () => {
    const k = +getComputedStyle(document.body).getPropertyValue('--k');
    f(k);
  }, { passive: true });

  // arrow keys (optional convenience)
  addEventListener('keydown', (e) => {
    if (e.key === 'ArrowDown') window.scrollBy({ top: 80, behavior: 'smooth' });
    else if (e.key === 'ArrowUp') window.scrollBy({ top: -80, behavior: 'smooth' });
  });
})();
</script>
</body>
</html>
